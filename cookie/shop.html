<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title></title>
          <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" rel="stylesheet">

    </head>
    
     <script type="text/javascript">
        
         var bookinfo = [
            {bookid:1,bookName:"html+css",price:35},
              {bookid:2,bookName:"juqery",price:30},
                {bookid:3,bookName:"mysql从删库到跑路",price:55},
                  {bookid:4,bookName:"vue 从入门到放弃",price:65},
                  {bookid:5,bookName:"php 是世界上最好语言",price:49},
                    {bookid:6,bookName:"三生三世十里桃花",price:29},
                      {bookid:7,bookName:"时间都去哪儿了",price:35},
                        {bookid:8,bookName:"唱跳rap篮球",price:99},
                        {bookid:9,bookName:"大主宰",price:30}
         ]
        
     </script>
    <body>
          
          <div class="container" style="margin-top:30px">
            
             <h1></h1>
           <a href="car.html" class="pull-right">
                我的购物车
            <span id="" class="glyphicon glyphicon-shopping-cart">
                
            </span>
           </a> 
           
           <div class="clearfix">
            
           </div>
         <hr />
              <table border="" class="table table-bordered table-hover" cellspacing="" cellpadding="">
                <tr>
                    <th  class="text-center">商品编号</th>
                    <th  class="text-center">商品名称</th>
                    <th  class="text-center">商品价格</th>
                    <th  class="text-center">操作</th>
                    
                </tr>
                
              </table>
          </div>
    </body>
    <script src="../jquery3.min.js"></script>
     <script type="text/javascript">
         
        for(k in bookinfo){
            
            var str = `
              <tr>
                    <td class="text-center">${bookinfo[k].bookid}</td>
                    <td  class="text-center">${bookinfo[k].bookName}</td>
                    <td  class="text-center">¥${bookinfo[k].price}.00</td>
                    <td  class="text-center"><a href="javacript:void(0)" onclick="addcar(${k})" class='btn btn-danger'> 加入购物车</a></td>
                    
                </tr>
            `;
            
            $(".table").append(str)
            
        }
        
        
        // 添加购物车 
          //var data =[];
          //  无条件 先读取购物车数组
           var arr = document.cookie.split(";");
           var data = ;
      //var data;
         
            var data =  arr.filter(function(val){
                
                if(val.indexOf("item") >0){
                    
                    return true;
                }
                // console.log(val)
            })
            
           
        function addcar(k){
        
           
                     // 无条件 读取cookie 
               var item = bookinfo[k]; 
             
                 if(data.length != 0 ){
                    // 原购车 有数据 
                        var car = data[0].split("=")[1]
             
                        car = JSON.parse(car);
                         
                 
                          var row =  car.filter(function(val){
                            
                               if(val.bookid == item.bookid){
                                    
                                    val.count++;
                                    return true;
                               }
                              
                          })
                          
                          if(row.length == 0){
                            
                              item.count = 1;
                              car.push(item);
                          }
                          data = car; 
                       }else{
                    //第一次 添加购物车数据
                     
                      item.count=1;
                        data.push(item);
                    
                 }
            // 新增数量 
           
             
                
            var dataStr = JSON.stringify(data);
             
                var date = new Date();
               
              // js  1970 /1/1    毫秒 
             var timestamp = date.getTime();
         
              // 过期时间
             var offsetTime = timestamp+30*1000;
             
             // 设置 过期时间
          date.setTime(offsetTime);
             
             document.cookie="item="+dataStr+";expires="+date.toGMTString();
        }
        
</script>
</html>
